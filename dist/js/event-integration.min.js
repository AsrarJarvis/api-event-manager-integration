var EventManagerIntegration={};EventManagerIntegration=EventManagerIntegration||{},EventManagerIntegration.Event=EventManagerIntegration.Event||{},EventManagerIntegration.Event.Module=function(e){function t(){e(function(){this.initEventPagination()}.bind(this))}return t.prototype.initEventPagination=function(){e(".modularity-mod-event").each(function(n,a){var o=e(this).find(".box-panel").attr("module-id"),i=e(this).find(".module-pagination").attr("data-pages");e(".modularity-mod-event-"+o+" .module-pagination").pagination({pages:i,displayedPages:3,edges:1,cssStyle:"light-theme",ellipsePageSet:!1,prevText:"&laquo;",nextText:"&raquo;",currentPage:1,selectOnClick:!1,onPageClick:function(n,a){t.prototype.loadEvents(n,o),e(".modularity-mod-event-"+o+" .module-pagination").pagination("redraw")}})})},t.prototype.loadEvents=function(t,n){var a=e(".modularity-mod-event-"+n),o=e(a).find(".module-content").height();e.ajax({url:eventintegration.ajaxurl,type:"post",data:{action:"ajax_pagination",page:t,id:n},beforeSend:function(){e(a).find(".event-module-list").remove(),e(a).find(".module-content").append('<div class="event-load-box"><div class="loader">'+eventIntegrationFront.loading+"...</div></div>"),e(a).find(".event-load-box").height(o)},success:function(t){e(a).find(".event-load-box").remove(),e(a).find(".module-content").append(t).hide().fadeIn(80).height("auto")}})},new t}(jQuery),EventManagerIntegration=EventManagerIntegration||{},EventManagerIntegration.Widget=EventManagerIntegration.Widget||{},EventManagerIntegration.Widget.TemplateParser=function(e){function t(){this.init()}var n=new Date,a=n.getDate(),o=n.getMonth()+1,i=n.getFullYear(),l=["jan","feb","mar","apr","maj","jun","jul","aug","sep","okt","nov","dec"];return t.prototype.init=function(){e(".event-api").each(function(t,n){var l=e(n).attr("data-apiurl");l=l.replace(/\/$/,""),l=l+"/time?start="+i+"-"+o+"-"+a+"&end="+(i+1)+"-"+o+"-"+a;var r=e(n).attr("post-limit"),c=e(n).attr("group-id"),d=e(n).attr("category-id"),s="undefined"!=typeof r&&e.isNumeric(r)?l+"&post-limit="+r:l+"&post-limit=10";s+="undefined"!=typeof c?"&group-id="+c:s,s+="undefined"!=typeof d?"&category-id="+d:s,s+="&_jsonp=getevents",this.storeErrorTemplate(e(n)),this.storeTemplate(e(n)),this.storeModalTemplate(e(n)),this.loadEvent(e(n),s)}.bind(this))},t.prototype.storeTemplate=function(t){t.data("template",e(".template",t).html()),t.find(".template").remove()},t.prototype.storeErrorTemplate=function(t){t.data("error-template",e(".error-template",t).html()),t.find(".error-template").remove()},t.prototype.storeModalTemplate=function(t){t.data("modal-template",e(".modal-template",t).html()),t.find(".modal-template").remove()},t.prototype.loadEvent=function(n,a){e.ajax({type:"GET",url:a,cache:!1,dataType:"jsonp",jsonpCallback:"getevents",crossDomain:!0,success:function(a){n.data("json-response",a),t.prototype.clear(n),e(a).each(function(t,a){var o="";e.each(a.occasions,function(e,t){if("undefined"!=typeof t.current_occasion&&1==t.current_occasion)return o=t,!1});var i=new Date(o.start_date),r=n.data("template");r=r.replace("{event-id}",a.id),r=r.replace("{event-occasion}",i.getDate()+'<div class="clearfix"></div>'+l[i.getMonth()]),r=r.replace("{event-title}",'<p class="link-item">'+a.title.rendered+"</p>"),n.append(r)}),t.prototype.click(n)},error:function(e){t.prototype.clear(n),n.html(n.data("error-template"))}})},t.prototype.clear=function(e){jQuery(e).html("")},t.prototype.addZero=function(e){return e<10&&(e="0"+e),e},t.prototype.click=function(t){jQuery("li a",t).on("click",{},function(n){var a=jQuery(n.target).closest("a.modal-event").data("event-id");e.each(t.data("json-response"),function(n,o){if(o.id==a){var i=t.data("modal-template");i=i.replace("{event-modal-title}",o.title.rendered),i=i.replace("{event-modal-content}",null!=o.content.rendered?o.content.rendered:""),i=i.replace("{event-modal-link}",null!=o.event_link?'<p><a href="'+o.event_link+'" target="_blank">'+o.event_link+"</a></p>":""),i=i.replace("{event-modal-image}",null!=o.featured_media?"<img src="+o.featured_media.source_url+' alt="'+o.title.rendered+'" style="display:block; width:100%;">':"");var r="";e.each(o.occasions,function(e,t){var n=new Date(t.start_date),a=this.addZero(n.getDate())+" "+l[n.getMonth()]+" "+n.getFullYear()+" kl. "+this.addZero(n.getHours())+":"+this.addZero(n.getMinutes()),o=new Date(t.end_date),i="";i=o.getDate()===n.getDate()?"kl. "+this.addZero(o.getHours())+":"+this.addZero(o.getMinutes()):o.getDate()+" "+l[o.getMonth()]+" "+o.getFullYear()+" kl. "+this.addZero(o.getHours())+":"+this.addZero(o.getMinutes()),r=r+'<li class="text-sm gutter-sm gutter-vertical">'+a+" - "+i+"</li>"}.bind(this)),i=i.replace("{event-modal-occations}",'<section class="accordion-section"><input type="radio" name="active-section" id="accordion-section-1"><label class="accordion-toggle" for="accordion-section-1"><h2>Evenemanget inträffar</h2></label><div class="accordion-content"><ul id="modal-occations">'+r+"</ul></div></section>");var c="";c+=null!=o.location&&null!=o.location.title?"<li><strong>"+o.location.title+"</strong></li>":"",c+=null!=o.location&&null!=o.location.street_address?"<li>"+o.location.street_address+"</li>":"",c+=null!=o.location&&null!=o.location.postal_code?"<li>"+o.location.postal_code+"</li>":"",c+=null!=o.location&&null!=o.location.city?"<il>"+o.location.city+"</li>":"";var d=c?'<section class="accordion-section"><input type="radio" name="active-section" id="accordion-section-2"><label class="accordion-toggle" for="accordion-section-2"><h2>Plats</h2></label><div class="accordion-content"><ul>'+c+"</ul></div></section>":"";i=i.replace("{event-modal-location}",d);var s="";s+=null!=o.booking_phone?"<li>Telefon: "+o.booking_phone+"</li>":"",s+=null!=o.price_adult?"<li>Pris: "+o.price_adult+" kr</li>":"",s+=null!=o.price_children?"<li>Barnpris: "+o.price_children+" kr</li>":"",s+=null!=o.price_senior?"<li>Pensionärspris: "+o.price_senior+" kr</li>":"",s+=null!=o.price_student?"<li>Studentpris: "+o.price_student+" kr</li>":"",s+=null!=o.age_restriction?"<li>Åldersgräns: "+o.age_restriction+" kr</li>":"";var p="";e.each(o.membership_cards,function(e,t){p=p+"<li>"+t.post_title+"</li>"}.bind(this)),s+=p?"<li>&nbsp;</li><li><strong>Ingår i medlemskort</strong></li>"+p:"",s+=null!=o.booking_link?'<li>&nbsp;</li><li><a href="'+o.booking_link+'" class="link-item" target="_blank">Boka bljetter här</a></li>':"";var u=s?'<section class="accordion-section"><input type="radio" name="active-section" id="accordion-section-3"><label class="accordion-toggle" for="accordion-section-3"><h2>Bokning</h2></label><div class="accordion-content"><ul>'+s+"</ul></div></section>":"";i=i.replace("{event-modal-booking}",u),e("#modal-event").remove(),e("body").append(i)}}.bind(this))}.bind(this))},new t}(jQuery);